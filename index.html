<!--
<!DOCTYPE html>
<html lang="th">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNE-QRChkPntDaily(CRS)</title>
</head>
<body>
    <iframe style="width: 100%; height: 100vh;" scrolling="yes" src="https://script.google.com/macros/s/AKfycbwQBB4Qkd6DBXG5_JppJrg8EBp01m_AfnW6eFOVdXozr-8FDJwY82UlWXeHVUqKiLn7/exec" frameborder="0"></iframe>
</body>
</html>
-->
<!--
<!DOCTYPE html>
<html>
<head>
    <title>Redirecting...</title>
    <script type="text/javascript">
        window.location.href = "https://script.google.com/macros/s/AKfycbxsdatS8yyjhAt_U89YhSLJ5Bsgh-DNKoCh6rBIpNXTeS27kCBbApOL1yplkT_-CL3U/exec";
    </script>
</head>
<body>
    <!-- ข้อความสำรองในกรณีที่ JavaScript ถูกปิดการใช้งาน --> <!--
    <p>If you are not redirected automatically, follow this <a href="https://script.google.com/macros/s/AKfycbxsdatS8yyjhAt_U89YhSLJ5Bsgh-DNKoCh6rBIpNXTeS27kCBbApOL1yplkT_-CL3U/exec">link</a>.</p>
</body>
</html>

-->


<!--
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #video { display: none; }
        #canvas { display: none; }
        #result { margin-top: 20px; font-size: 18px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <video id="video" width="100%" height="100%" autoplay></video>
    <canvas id="canvas"></canvas>
    <div id="result">Scan a QR code</div>

    <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const result = document.getElementById('result');
        const context = canvas.getContext('2d');

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = stream;
                video.setAttribute("playsinline", true);
                video.play();
                requestAnimationFrame(tick);
            } catch (error) {
                result.textContent = 'Error accessing camera: ' + error.message;
                result.classList.add('error');
            }
        }

        function tick() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                const code = jsQR(imageData.data, canvas.width, canvas.height, {
                    inversionAttempts: "dontInvert",
                });
                
                if (code) {
                    const qrData = code.data;
                    try {
                        new URL(qrData); // Validates if qrData is a URL
                        window.location.href = qrData; // Redirect to URL
                    } catch (e) {
                        result.textContent = `QR Code Data: ${qrData}`; // Not a URL
                        result.classList.remove('error');
                        result.classList.add('success');
                    }
                } else {
                    result.textContent = 'QR Code not found!!!';
                    result.classList.remove('success');
                    result.classList.add('error');
                }
            }
            requestAnimationFrame(tick);
        }

        window.addEventListener('load', startCamera);
    </script>
</body>
</html>
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #video { display: none; }
        #canvas { display: none; }
        #result { margin-top: 20px; font-size: 18px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <video id="video" width="100%" height="100%" autoplay></video>
    <canvas id="canvas"></canvas>
    <div id="result">Scan a QR code</div>

    <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const result = document.getElementById('result');
        const context = canvas.getContext('2d');
        let messageToggle = true;
        let scanInterval;

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = stream;
                video.setAttribute("playsinline", true);
                video.play();
                requestAnimationFrame(tick);
                startMessageToggle();
            } catch (error) {
                result.textContent = 'Error accessing camera: ' + error.message;
                result.classList.add('error');
            }
        }

        function startMessageToggle() {
            scanInterval = setInterval(() => {
                result.textContent = messageToggle ? 'Scanning...' : 'QR Code not found!!!';
                result.classList.toggle('error', !messageToggle);
                result.classList.toggle('success', messageToggle);
                messageToggle = !messageToggle;
            }, 3000); // Toggle every 3 seconds
        }

        function tick() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                const code = jsQR(imageData.data, canvas.width, canvas.height, {
                    inversionAttempts: "dontInvert",
                });
                
                if (code) {
                    const qrData = code.data;
                    try {
                        new URL(qrData); // Validates if qrData is a URL
                        clearInterval(scanInterval); // Stop message toggle
                        window.location.href = qrData; // Redirect to URL
                    } catch (e) {
                        clearInterval(scanInterval); // Stop message toggle
                        result.textContent = `QR Code Data: ${qrData}`; // Not a URL
                        result.classList.remove('error');
                        result.classList.add('success');
                    }
                } else {
                    result.textContent = 'QR Code not found!!!';
                    result.classList.remove('success');
                    result.classList.add('error');
                }
            }
            requestAnimationFrame(tick);
        }

        window.addEventListener('load', startCamera);
    </script>
</body>
</html>




